<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Todo App with Supabase Auth</title>
  <style>
    :root {
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#7c5cff; --accent-2:#00d4ff; --success:#2dd4bf; --danger:#ff6b6b; --glass:rgba(255,255,255,0.04); --radius:14px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#051226 0%, #071225 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:32px;}
    .app{width:100%;max-width:760px;background:rgba(255,255,255,0.02);border-radius:var(--radius);box-shadow:0 8px 30px rgba(2,6,23,0.6);overflow:hidden;border:1px solid rgba(255,255,255,0.03);}
    header{padding:24px;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(90deg, rgba(124,92,255,0.06), rgba(0,212,255,0.03));}
    h1{margin:0;font-size:20px;}
    .muted{color:var(--muted);font-size:13px;}
    input,button{font-family:inherit;}
    .auth-section{padding:20px;display:flex;flex-direction:column;gap:12px;border-top:1px solid rgba(255,255,255,0.05);}
    .auth-section input{padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;}
    .auth-section button{padding:10px;border-radius:8px;cursor:pointer;border:0;font-weight:600;}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#061018;}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);}
    .hidden{display:none;}
    .add-row{padding:20px;border-top:1px solid rgba(255,255,255,0.02);display:flex;gap:12px;align-items:center;}
    #newTask{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;outline:none;font-size:15px;}
    .list{padding:18px 20px 28px;display:flex;flex-direction:column;gap:10px;}
    .task{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02);}
    .label{flex:1;font-size:15px;padding:4px 6px;border-radius:8px;outline:none;word-break:break-word;}
    .label.completed{text-decoration:line-through;color:rgba(230,238,246,0.45);}
    .icon-btn{background:transparent;border:0;padding:6px;border-radius:8px;cursor:pointer;color:var(--muted);}
    button.btn, button.btn * {cursor: pointer;}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>My Tasks</h1>
        <p class="muted">Supabase-backed To-do List with Auth</p>
      </div>
      <button id="logoutBtn" class="btn ghost hidden">Log out</button>
    </header>

    <section id="authSection" class="auth-section">
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Password" />
      <div style="display:flex;gap:10px;">
        <button id="loginBtn" class="btn primary">Login</button>
        <button id="signupBtn" class="btn ghost">Sign Up</button>
      </div>
      <div id="authMsg" class="muted"></div>
    </section>

    <section id="todoSection" class="hidden">
      <div class="add-row">
        <input id="newTask" type="text" placeholder="Add a task (press Enter)" />
        <button class="btn primary" id="addBtn">Add</button>
      </div>
      <main class="list" id="list"></main>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://fbokhdckirxuebpwpwwo.supabase.co';
    //const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiIsImZib2toZGNraXJ4dWVicHdwd3dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMDE5OTMsImV4cCI6MjA3ODU3Nzk5M30.K3l-l5lhQE9kIYuxdTXrEMHDHfHRbRzVV7nHjT8P9Oc';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZib2toZGNraXJ4dWVicHdwd3dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMDE5OTMsImV4cCI6MjA3ODU3Nzk5M30.K3l-l5lhQE9kIYuxdTXrEMHDHfHRbRzVV7nHjT8P9Oc';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


    const authSection = document.getElementById('authSection');
    const todoSection = document.getElementById('todoSection');
    const logoutBtn = document.getElementById('logoutBtn');
    const emailEl = document.getElementById('email');
    const passwordEl = document.getElementById('password');
    const authMsg = document.getElementById('authMsg');

    const newTaskEl = document.getElementById('newTask');
    const addBtn = document.getElementById('addBtn');
    const listEl = document.getElementById('list');

    let user = null;
    let tasks = [];

    async function signUp() {
      const { data, error } = await supabase.auth.signUp({
        email: emailEl.value,
        password: passwordEl.value
      });
      if (error) authMsg.textContent = error.message; else authMsg.textContent = 'Signup successful, check your email to verify!';
    }

    async function signIn() {
      const { data, error } = await supabase.auth.signInWithPassword({
        email: emailEl.value,
        password: passwordEl.value
      });
      if (error) authMsg.textContent = error.message;
    }

    async function signOut() {
      await supabase.auth.signOut();
    }

    async function loadTodos() {
      const { data, error } = await supabase.from('todos').select('*').eq('user_id', user.id).order('inserted_at', { ascending: false });
      if (!error) tasks = data || []; else console.error(error);
      renderTodos();
    }

    function renderTodos() {
      listEl.innerHTML = '';
      if (tasks.length === 0) {
        const p = document.createElement('div');
        p.className = 'muted';
        p.style.padding = '20px';
        p.textContent = 'No tasks yet â€” add one!';
        listEl.appendChild(p);
        return;
      }
      tasks.forEach(t => {
        const row = document.createElement('div');
        row.className = 'task';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = t.completed;
        cb.addEventListener('change', () => toggleComplete(t.id));
        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = t.task_text;
        if (t.completed) label.classList.add('completed');
        label.addEventListener('dblclick', () => startEdit(t.id, label));
        const del = document.createElement('button');
        del.className = 'icon-btn';
        del.textContent = 'ðŸ—‘';
        del.addEventListener('click', () => deleteTask(t.id));
        row.append(cb, label, del);
        listEl.appendChild(row);
      });
    }

    async function addTask(text) {
      const trimmed = text.trim();
      if (!trimmed) return;
      const { data, error } = await supabase.from('todos').insert([{ task_text: trimmed, completed: false, user_id: user.id }]).select().single();
      if (error) console.error(error);
      else tasks.unshift(data);
      renderTodos();
    }

    async function toggleComplete(id) {
      const t = tasks.find(x => x.id === id);
      if (!t) return;
      const { error } = await supabase.from('todos').update({ completed: !t.completed }).eq('id', id);
      if (!error) t.completed = !t.completed;
      renderTodos();
    }

    async function deleteTask(id) {
      await supabase.from('todos').delete().eq('id', id);
      tasks = tasks.filter(t => t.id !== id);
      renderTodos();
    }

    async function startEdit(id, labelEl) {
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'label';
      input.value = labelEl.textContent;
      labelEl.replaceWith(input);
      input.focus();
      input.addEventListener('blur', async () => {
        const val = input.value.trim();
        if (val) await supabase.from('todos').update({ task_text: val }).eq('id', id);
        await loadTodos();
      });
      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') input.blur();
      });
    }

    addBtn.addEventListener('click', async () => {
      await addTask(newTaskEl.value);
      newTaskEl.value = '';
    });
    newTaskEl.addEventListener('keydown', async e => {
      if (e.key === 'Enter') {
        await addTask(newTaskEl.value);
        newTaskEl.value = '';
      }
    });

    document.getElementById('signupBtn').addEventListener('click', signUp);
    document.getElementById('loginBtn').addEventListener('click', signIn);
    logoutBtn.addEventListener('click', signOut);

    supabase.auth.onAuthStateChange(async (event, session) => {
      user = session?.user || null;
      if (user) {
        authSection.classList.add('hidden');
        todoSection.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');
        await loadTodos();
      } else {
        authSection.classList.remove('hidden');
        todoSection.classList.add('hidden');
        logoutBtn.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
